{% extends 'chamados/base.html' %}

{% block title %}
Lista de Chamados
{% endblock %}

{% block content %}

<form method="get" class="mb-4"> {# ðŸ”§ movido para dentro do bloco content #}
  <input type="text" name="busca" placeholder="Buscar por tÃ­tulo ou descriÃ§Ã£o" value="{{ valores.busca }}">

  <select name="status">
    <option value="">Todos os status</option>
    <option value="aberto" {% if valores.status == "aberto" %}selected{% endif %}>Aberto</option>
    <option value="em_andamento" {% if valores.status == "em_andamento" %}selected{% endif %}>Em Andamento</option>
    <option value="concluido" {% if valores.status == "concluido" %}selected{% endif %}>ConcluÃ­do</option>
  </select>

  <select name="prioridade">
    <option value="">Todas as prioridades</option>
    <option value="baixa" {% if valores.prioridade == "baixa" %}selected{% endif %}>Baixa</option>
    <option value="media" {% if valores.prioridade == "media" %}selected{% endif %}>MÃ©dia</option>
    <option value="alta" {% if valores.prioridade == "alta" %}selected{% endif %}>Alta</option>
  </select>

  <button type="submit">Filtrar</button>
</form>

<h1 class="mb-4">Chamados</h1>

<a href="{% url 'chamado_create' %}" class="btn btn-success mb-3">
  âž• Criar novo chamado
</a>

<table class="table table-striped table-bordered">
  <thead class="table-primary">
    <tr>
      <th>TÃ­tulo</th>
      <th>Status</th>
      <th>Prioridade</th>
      <th>Criado em</th>
      <th>AÃ§Ãµes</th>
    </tr>
  </thead>
  <tbody>
    {% for chamado in page_obj %}
    <tr>
      <td>
        {{ chamado.titulo }}
        <br>
        {# ðŸ“Ž Adicionado link de anexo, se existir #}
        {% if chamado.arquivo %}
          <a href="{{ chamado.arquivo.url }}" target="_blank">ðŸ“Ž Ver anexo</a>
        {% else %}
          <span class="text-muted">Sem anexo</span>
        {% endif %}
      </td>
      <td>{{ chamado.get_status_display }}</td>
      <td>{{ chamado.get_prioridade_display }}</td>
      <td>{{ chamado.criado_em|date:"d/m/Y H:i" }}</td>
      <td>
        <a href="{% url 'chamado_detail' chamado.pk %}" class="btn btn-sm btn-info">ðŸ’¬ ComentÃ¡rios</a>
        <a href="{% url 'chamado_edit' chamado.pk %}" class="btn btn-sm btn-primary">Editar</a>
        <a href="{% url 'chamado_delete' chamado.pk %}" class="btn btn-sm btn-danger">Excluir</a>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5" class="text-center">Nenhum chamado encontrado.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{# ðŸ”§ Corrigido: bloco de paginaÃ§Ã£o estava dentro do <tbody>, agora estÃ¡ fora! #}
<div class="pagination mt-3">
  <span>
    PÃ¡gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
  </span>

  <div class="mt-2">
    {% if page_obj.has_previous %}
      <a href="?{% if valores.busca %}busca={{ valores.busca }}&{% endif %}{% if valores.status %}status={{ valores.status }}&{% endif %}{% if valores.prioridade %}prioridade={{ valores.prioridade }}&{% endif %}page={{ page_obj.previous_page_number }}" class="btn btn-outline-primary btn-sm">â¬… Anterior</a>
    {% endif %}

    {% if page_obj.has_next %}
      <a href="?{% if valores.busca %}busca={{ valores.busca }}&{% endif %}{% if valores.status %}status={{ valores.status }}&{% endif %}{% if valores.prioridade %}prioridade={{ valores.prioridade }}&{% endif %}page={{ page_obj.next_page_number }}" class="btn btn-outline-primary btn-sm">PrÃ³xima âž¡</a>
    {% endif %}
  </div>
</div>

{% endblock %}
